{"version":3,"sources":["../src/index.ts"],"sourcesContent":["import { LRUCache } from 'lru-cache';\nimport { NextRequest } from 'next/server';\n\ntype Options = {\n  uniqueTokenPerInterval?: number;\n  interval?: number;\n};\n\nexport default function rateLimit(options?: Options) {\n  const tokenCache = new LRUCache<string, number[]>({\n    max: options?.uniqueTokenPerInterval || 500,\n    ttl: options?.interval || 60000\n  });\n\n  return {\n    checkNext: (req: NextRequest, limit: number) => {\n      const headers: Headers = new Headers();\n      const token =\n        req.ip ||\n        req.headers.get('x-forwarded-for') ||\n        req.headers.get('x-real-ip') ||\n        req.headers.get('x-client-ip') ||\n        '127.0.0.1';\n      const tokenCount = (tokenCache.get(token) as number[]) || [0];\n\n      if (tokenCount[0] === 0) tokenCache.set(token, tokenCount);\n\n      tokenCount[0] += 1;\n\n      const currentUsage = tokenCount[0] ?? 0;\n      const isRateLimited = currentUsage >= limit;\n      headers.set('X-RateLimit-Limit', limit.toString());\n      headers.set('X-RateLimit-Remaining', isRateLimited ? '0' : (limit - currentUsage).toString());\n\n      if (isRateLimited) throw new Error('Rate limit exceeded');\n\n      return headers;\n    }\n  };\n}\n"],"mappings":"AAAA,OAAS,YAAAA,MAAgB,YAQV,SAARC,EAA2BC,EAAmB,CACnD,IAAMC,EAAa,IAAIH,EAA2B,CAChD,IAAKE,GAAS,wBAA0B,IACxC,IAAKA,GAAS,UAAY,GAC5B,CAAC,EAED,MAAO,CACL,UAAW,CAACE,EAAkBC,IAAkB,CAC9C,IAAMC,EAAmB,IAAI,QACvBC,EACJH,EAAI,IACJA,EAAI,QAAQ,IAAI,iBAAiB,GACjCA,EAAI,QAAQ,IAAI,WAAW,GAC3BA,EAAI,QAAQ,IAAI,aAAa,GAC7B,YACII,EAAcL,EAAW,IAAII,CAAK,GAAkB,CAAC,CAAC,EAExDC,EAAW,CAAC,IAAM,GAAGL,EAAW,IAAII,EAAOC,CAAU,EAEzDA,EAAW,CAAC,GAAK,EAEjB,IAAMC,EAAeD,EAAW,CAAC,GAAK,EAChCE,EAAgBD,GAAgBJ,EAItC,GAHAC,EAAQ,IAAI,oBAAqBD,EAAM,SAAS,CAAC,EACjDC,EAAQ,IAAI,wBAAyBI,EAAgB,KAAOL,EAAQI,GAAc,SAAS,CAAC,EAExFC,EAAe,MAAM,IAAI,MAAM,qBAAqB,EAExD,OAAOJ,CACT,CACF,CACF","names":["LRUCache","rateLimit","options","tokenCache","req","limit","headers","token","tokenCount","currentUsage","isRateLimited"]}